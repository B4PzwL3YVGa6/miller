
================================================================
GRAMMAR REORG


---------------------------------------------------------------- simplest
mlr -n put -v #
AST BEGIN STATEMENTS (0):
AST MAIN STATEMENTS (0):
AST END STATEMENTS (0):
AST ROOT:
list (statement_list):
AST->CST STUB

mlr -n put -v #$m=2
AST BEGIN STATEMENTS (0):
AST MAIN STATEMENTS (0):
AST END STATEMENTS (0):
AST ROOT:
list (statement_list):
    = (srec_assignment):
        m (field_name).
        2 (strnum_literal).
AST->CST STUB
GOT MAIN:srec_assignment

mlr -n put -v #$m=2;$m=3
AST BEGIN STATEMENTS (0):
AST MAIN STATEMENTS (0):
AST END STATEMENTS (0):
AST ROOT:
list (statement_list):
    = (srec_assignment):
        m (field_name).
        2 (strnum_literal).
    = (srec_assignment):
        m (field_name).
        3 (strnum_literal).
AST->CST STUB
GOT MAIN:srec_assignment
GOT MAIN:srec_assignment

mlr -n put -v #$m=2;$m=3;$m=4
AST BEGIN STATEMENTS (0):
AST MAIN STATEMENTS (0):
AST END STATEMENTS (0):
AST ROOT:
list (statement_list):
    = (srec_assignment):
        m (field_name).
        2 (strnum_literal).
    = (srec_assignment):
        m (field_name).
        3 (strnum_literal).
    = (srec_assignment):
        m (field_name).
        4 (strnum_literal).
AST->CST STUB
GOT MAIN:srec_assignment
GOT MAIN:srec_assignment
GOT MAIN:srec_assignment

mlr -n put -v #$m=2;;$m=3;$m=4
AST BEGIN STATEMENTS (0):
AST MAIN STATEMENTS (0):
AST END STATEMENTS (0):
AST ROOT:
list (statement_list):
    = (srec_assignment):
        m (field_name).
        2 (strnum_literal).
    = (srec_assignment):
        m (field_name).
        3 (strnum_literal).
    = (srec_assignment):
        m (field_name).
        4 (strnum_literal).
AST->CST STUB
GOT MAIN:srec_assignment
GOT MAIN:srec_assignment
GOT MAIN:srec_assignment


---------------------------------------------------------------- begin/main/end
mlr -n put -v #begin{@b=1};$m=2;end{@e=3}
AST BEGIN STATEMENTS (0):
AST MAIN STATEMENTS (0):
AST END STATEMENTS (0):
AST ROOT:
list (statement_list):
    begin (begin):
        list (statement_list):
            = (oosvar_assignment):
                b (oosvar_name).
                1 (strnum_literal).
    = (srec_assignment):
        m (field_name).
        2 (strnum_literal).
    end (end):
        list (statement_list):
            = (oosvar_assignment):
                e (oosvar_name).
                3 (strnum_literal).
AST->CST STUB
GOT BEGIN:begin
-- WITHIN BEGIN:oosvar_assignment
GOT MAIN:srec_assignment
GOT END:end
-- WITHIN END:oosvar_assignment


---------------------------------------------------------------- main:cond
mlr -n put -v #true{$m=2}
AST BEGIN STATEMENTS (0):
AST MAIN STATEMENTS (0):
AST END STATEMENTS (0):
AST ROOT:
list (statement_list):
    cond (conditional_block):
        true (boolean_literal).
        list (statement_list):
            = (srec_assignment):
                m (field_name).
                2 (strnum_literal).
AST->CST STUB
GOT MAIN:conditional_block


---------------------------------------------------------------- main:empty-for
mlr -n put -v #for(k,v in $*) { }
AST BEGIN STATEMENTS (0):
AST MAIN STATEMENTS (0):
AST END STATEMENTS (0):
AST ROOT:
list (statement_list):
    for (for-srec):
        variables (for-variables):
            k (non_sigil_name).
            v (non_sigil_name).
        list (statement_list):
AST->CST STUB
GOT MAIN:for-srec
FOR SREC STUB
cst_statement_alloc_for_srec stub!


---------------------------------------------------------------- main:single-statement-for
mlr -n put -v #for(k,v in $*) { $m=1}
AST BEGIN STATEMENTS (0):
AST MAIN STATEMENTS (0):
AST END STATEMENTS (0):
AST ROOT:
list (statement_list):
    for (for-srec):
        variables (for-variables):
            k (non_sigil_name).
            v (non_sigil_name).
        list (statement_list):
            = (srec_assignment):
                m (field_name).
                1 (strnum_literal).
AST->CST STUB
GOT MAIN:for-srec
FOR SREC STUB
cst_statement_alloc_for_srec stub!


---------------------------------------------------------------- main:double-statement-for
mlr -n put -v #for(k,v in $*) { $m=1;$m=2 }
AST BEGIN STATEMENTS (0):
AST MAIN STATEMENTS (0):
AST END STATEMENTS (0):
AST ROOT:
list (statement_list):
    for (for-srec):
        variables (for-variables):
            k (non_sigil_name).
            v (non_sigil_name).
        list (statement_list):
            = (srec_assignment):
                m (field_name).
                1 (strnum_literal).
            = (srec_assignment):
                m (field_name).
                2 (strnum_literal).
AST->CST STUB
GOT MAIN:for-srec
FOR SREC STUB
cst_statement_alloc_for_srec stub!


---------------------------------------------------------------- main:for w/ break/continue
mlr -n put -v #for(k,v in $*) { $m=1;break;$m=2 }
AST BEGIN STATEMENTS (0):
AST MAIN STATEMENTS (0):
AST END STATEMENTS (0):
AST ROOT:
list (statement_list):
    for (for-srec):
        variables (for-variables):
            k (non_sigil_name).
            v (non_sigil_name).
        list (statement_list):
            = (srec_assignment):
                m (field_name).
                1 (strnum_literal).
            break (break).
            = (srec_assignment):
                m (field_name).
                2 (strnum_literal).
AST->CST STUB
GOT MAIN:for-srec
FOR SREC STUB
cst_statement_alloc_for_srec stub!
break alloc stub!

mlr -n put -v #for(k,v in $*) { $m=1;break;continue;$m=2 }
AST BEGIN STATEMENTS (0):
AST MAIN STATEMENTS (0):
AST END STATEMENTS (0):
AST ROOT:
list (statement_list):
    for (for-srec):
        variables (for-variables):
            k (non_sigil_name).
            v (non_sigil_name).
        list (statement_list):
            = (srec_assignment):
                m (field_name).
                1 (strnum_literal).
            break (break).
            continue (break).
            = (srec_assignment):
                m (field_name).
                2 (strnum_literal).
AST->CST STUB
GOT MAIN:for-srec
FOR SREC STUB
cst_statement_alloc_for_srec stub!
break alloc stub!
break alloc stub!

mlr -n put -v #for(k,v in $*) { $m=1;break;continue;;$m=2 }
AST BEGIN STATEMENTS (0):
AST MAIN STATEMENTS (0):
AST END STATEMENTS (0):
AST ROOT:
list (statement_list):
    for (for-srec):
        variables (for-variables):
            k (non_sigil_name).
            v (non_sigil_name).
        list (statement_list):
            = (srec_assignment):
                m (field_name).
                1 (strnum_literal).
            break (break).
            continue (break).
            = (srec_assignment):
                m (field_name).
                2 (strnum_literal).
AST->CST STUB
GOT MAIN:for-srec
FOR SREC STUB
cst_statement_alloc_for_srec stub!
break alloc stub!
break alloc stub!


---------------------------------------------------------------- main:for:cond
mlr -n put -v #for(k,v in $*) { true{$m=3} }
AST BEGIN STATEMENTS (0):
AST MAIN STATEMENTS (0):
AST END STATEMENTS (0):
AST ROOT:
list (statement_list):
    for (for-srec):
        variables (for-variables):
            k (non_sigil_name).
            v (non_sigil_name).
        list (statement_list):
            cond (conditional_block):
                true (boolean_literal).
                list (statement_list):
                    = (srec_assignment):
                        m (field_name).
                        3 (strnum_literal).
AST->CST STUB
GOT MAIN:for-srec
FOR SREC STUB
cst_statement_alloc_for_srec stub!


---------------------------------------------------------------- main:cond:for
mlr -n put -v #true{ for(k,v in $*) { $m=1 } }
AST BEGIN STATEMENTS (0):
AST MAIN STATEMENTS (0):
AST END STATEMENTS (0):
AST ROOT:
list (statement_list):
    cond (conditional_block):
        true (boolean_literal).
        list (statement_list):
            for (for-srec):
                variables (for-variables):
                    k (non_sigil_name).
                    v (non_sigil_name).
                list (statement_list):
                    = (srec_assignment):
                        m (field_name).
                        1 (strnum_literal).
AST->CST STUB
GOT MAIN:conditional_block
FOR SREC STUB
cst_statement_alloc_for_srec stub!

mlr -n put -v #true{ for(k,v in $*) { $m=1;break;continue;;$m=2 } }
AST BEGIN STATEMENTS (0):
AST MAIN STATEMENTS (0):
AST END STATEMENTS (0):
AST ROOT:
list (statement_list):
    cond (conditional_block):
        true (boolean_literal).
        list (statement_list):
            for (for-srec):
                variables (for-variables):
                    k (non_sigil_name).
                    v (non_sigil_name).
                list (statement_list):
                    = (srec_assignment):
                        m (field_name).
                        1 (strnum_literal).
                    break (break).
                    continue (break).
                    = (srec_assignment):
                        m (field_name).
                        2 (strnum_literal).
AST->CST STUB
GOT MAIN:conditional_block
FOR SREC STUB
cst_statement_alloc_for_srec stub!
break alloc stub!
break alloc stub!


---------------------------------------------------------------- main:cond:for:cond
mlr -n put -v #true{ for(k,v in $*) { true{$m=3} } }
AST BEGIN STATEMENTS (0):
AST MAIN STATEMENTS (0):
AST END STATEMENTS (0):
AST ROOT:
list (statement_list):
    cond (conditional_block):
        true (boolean_literal).
        list (statement_list):
            for (for-srec):
                variables (for-variables):
                    k (non_sigil_name).
                    v (non_sigil_name).
                list (statement_list):
                    cond (conditional_block):
                        true (boolean_literal).
                        list (statement_list):
                            = (srec_assignment):
                                m (field_name).
                                3 (strnum_literal).
AST->CST STUB
GOT MAIN:conditional_block
FOR SREC STUB
cst_statement_alloc_for_srec stub!


---------------------------------------------------------------- ifs
mlr -n put -v #
  if (NR==1) {
    $x = 2;
    $x = 3
  };
  if (NR == 4) {
    $x = 5;
    $x = 6
  } else {
    $x = 7;
    $x = 8
  };
  if (NR == 9) {
    $x = 10;
    $x = 11
  } elif (NR == 12) {
    $x = 13;
    $x = 14
  } else {
    $x = 15;
    $x = 16
  };
  if (NR == 17) {
    $x = 18;
    $x = 19
  } elif (NR == 20) {
    $x = 21;
    $x = 22
  } elif (NR == 23) {
    $x = 24;
    $x = 25
  } else {
    $x = 26;
    $x = 27
  }
AST BEGIN STATEMENTS (0):
AST MAIN STATEMENTS (0):
AST END STATEMENTS (0):
AST ROOT:
list (statement_list):
    if_head (if_head):
        if (if_item):
            == (operator):
                NR (context_variable).
                1 (strnum_literal).
            list (statement_list):
                = (srec_assignment):
                    x (field_name).
                    2 (strnum_literal).
                = (srec_assignment):
                    x (field_name).
                    3 (strnum_literal).
    if_head (if_head):
        if (if_item):
            == (operator):
                NR (context_variable).
                4 (strnum_literal).
            list (statement_list):
                = (srec_assignment):
                    x (field_name).
                    5 (strnum_literal).
                = (srec_assignment):
                    x (field_name).
                    6 (strnum_literal).
        else (if_item):
            list (statement_list):
                = (srec_assignment):
                    x (field_name).
                    7 (strnum_literal).
                = (srec_assignment):
                    x (field_name).
                    8 (strnum_literal).
    if_head (if_head):
        if (if_item):
            == (operator):
                NR (context_variable).
                9 (strnum_literal).
            list (statement_list):
                = (srec_assignment):
                    x (field_name).
                    10 (strnum_literal).
                = (srec_assignment):
                    x (field_name).
                    11 (strnum_literal).
        elif (if_item):
            == (operator):
                NR (context_variable).
                12 (strnum_literal).
            list (statement_list):
                = (srec_assignment):
                    x (field_name).
                    13 (strnum_literal).
                = (srec_assignment):
                    x (field_name).
                    14 (strnum_literal).
    if_head (if_head):
        if (if_item):
            == (operator):
                NR (context_variable).
                17 (strnum_literal).
            list (statement_list):
                = (srec_assignment):
                    x (field_name).
                    18 (strnum_literal).
                = (srec_assignment):
                    x (field_name).
                    19 (strnum_literal).
        elif (if_item):
            == (operator):
                NR (context_variable).
                20 (strnum_literal).
            list (statement_list):
                = (srec_assignment):
                    x (field_name).
                    21 (strnum_literal).
                = (srec_assignment):
                    x (field_name).
                    22 (strnum_literal).
AST->CST STUB
GOT MAIN:if_head
IF_HEAD STUB
cst_statement_alloc_if_head stub!
GOT MAIN:if_head
IF_HEAD STUB
cst_statement_alloc_if_head stub!
GOT MAIN:if_head
IF_HEAD STUB
cst_statement_alloc_if_head stub!
GOT MAIN:if_head
IF_HEAD STUB
cst_statement_alloc_if_head stub!

